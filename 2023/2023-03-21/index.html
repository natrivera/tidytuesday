<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <style>
  
    svg {
      display: block;
      margin: auto;
    }
    
    .links line {
      stroke: #999;
      stroke-opacity: 0.6;
    }

    .nodes circle {
      stroke: black;
      stroke-width: 0px;
    }
    
  </style>
</head>

<body>
  <svg width="360" height="700"></svg>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script>
    //create somewhere to put the force directed graph
    var svg = d3.select("svg"),
      width = +svg.attr("width"),
      height = +svg.attr("height");

    var radius = 15;
    
    var nodes_data = [
      {"name":"S"},
      {"name":"C"},
      {"name":"APL"},
      {"name":"MATLAB"},
      {"name":"SPSS"},
      {"name":"B"},
      {"name":"BCPL"},
      {"name":"CPL"},
      {"name":"AMPL"},
      {"name":"C--"},
      {"name":"D"},
      {"name":"LPC"},
      {"name":"PHP"},
      {"name":"MATHLAB"},
      {"name":"R"},
      {"name":"IDL"},
      {"name":"APLX"},
      {"name":"J"},
      {"name":"K"},
      {"name":"Q"},
      {"name":"BASIC"},
      {"name":"COBOL"},
      {"name":"CIL"},
      {"name":"RPL"},
      {"name":"S-PLUS"}];


   var links_data = [
     {"source":"R","target":"S","relationship":"first"},
     {"source":"R","target":"C","relationship":"first"},
     {"source":"R","target":"APL","relationship":"first"},
     {"source":"R","target":"MATLAB","relationship":"first"},
     {"source":"R","target":"SPSS","relationship":"first"},
     {"source":"C","target":"B","relationship":"second"},
     {"source":"C","target":"BCPL","relationship":"second"},
     {"source":"C","target":"CPL","relationship":"second"},
     {"source":"C","target":"AMPL","relationship":"second"},
     {"source":"C","target":"C--","relationship":"second"},
     {"source":"C","target":"D","relationship":"second"},
     {"source":"C","target":"LPC","relationship":"second"},
     {"source":"C","target":"PHP","relationship":"second"},
     {"source":"C","target":"MATLAB","relationship":"second"},
     {"source":"MATLAB","target":"MATHLAB","relationship":"second"},
     {"source":"MATLAB","target":"C","relationship":"second"},
     {"source":"MATLAB","target":"APL","relationship":"second"},
     {"source":"MATLAB","target":"IDL","relationship":"second"},
     {"source":"MATLAB","target":"S","relationship":"second"},
     {"source":"APL","target":"APLX","relationship":"second"},
     {"source":"APL","target":"J","relationship":"second"},
     {"source":"APL","target":"K","relationship":"second"},
     {"source":"APL","target":"MATLAB","relationship":"second"},
     {"source":"APL","target":"Q","relationship":"second"},
     {"source":"APL","target":"S","relationship":"second"},
     {"source":"APL","target":"BASIC","relationship":"second"},
     {"source":"APL","target":"COBOL","relationship":"second"},
     {"source":"APL","target":"C","relationship":"second"},
     {"source":"APL","target":"CIL","relationship":"second"},
     {"source":"APL","target":"RPL","relationship":"second"},
     {"source":"S","target":"S-PLUS","relationship":"second"},
     {"source":"S","target":"C","relationship":"second"},
     {"source":"S","target":"APL","relationship":"second"}];
    

    datalink = "relationships.json"
    d3.json(datalink, function(err, graph) {
      if (err) throw err;
      nodes_data = graph.nodes;
      links_data = graph.links;
    });

    //set up the simulation and add forces
    var simulation = d3.forceSimulation()
      .nodes(nodes_data);

    var link_force = d3.forceLink(links_data)
      .id(function(d) {
        return d.name;
      });

    var charge_force = d3.forceManyBody()
      .strength(-500);

    var center_force = d3.forceCenter(width / 2, height / 2);

    simulation
      .force("charge_force", charge_force)
      .force("center_force", center_force)
      .force("links", link_force);


    //add tick instructions:
    simulation.on("tick", tickActions);

    //add encompassing group for the zoom
    var g = svg.append("g")
      .attr("class", "everything");

    //draw lines for the links
    var link = g.append("g")
      .attr("class", "links")
      .selectAll("line")
      .data(links_data)
      .enter().append("line")
      .attr("stroke-width", 2)
      .style("stroke", linkColour);

    //draw circles for the nodes
    var node = g.append("g")
      .attr("class", "nodes")
      .selectAll("circle")
      .data(nodes_data)
      .enter()
      .append("circle")
      .attr("r", radius)
      .attr("fill", circleColour);
      
    node.append("svg:text")
      .attr("dx" , 0)
      .attr("dy" , 0)
      .attr("font-size" , "1em")
      .text(function(d) {return d.name}) ;
      
    var texts = g.append("g")
      .attr("class", "nodes")
      .selectAll("circle")
      .data(nodes_data)
      .enter()
      //.attr("dx" , 1)
      //.attr("dy" , "1em")
      .text(function(d) {return d.name}) ;
      

    //add drag capabilities
    var drag_handler = d3.drag()
      .on("start", drag_start)
      .on("drag", drag_drag)
      .on("end", drag_end);

    drag_handler(node);


    //add zoom capabilities
    var zoom_handler = d3.zoom()
      .on("zoom", zoom_actions);

    zoom_handler(svg);

    /** Functions **/

    //Function to choose what color circle we have
    //Let's return blue for males and red for females
    function circleColour(d) {
      if (d.name == "R") {
        return "blue";
      } else {
        return "pink";
      }
    }

    //Function to choose the line colour and thickness
    //If the link type is "A" return green
    //If the link type is "E" return red
    function linkColour(d) {
      if (d.relationship == "first") {
        return "blue";
      } else {
        return "black";
      }
    }

    //Drag functions
    //d is the node
    function drag_start(d) {
      if (!d3.event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    //make sure you can't drag the circle outside the box
    function drag_drag(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    }

    function drag_end(d) {
      if (!d3.event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }

    //Zoom functions
    function zoom_actions() {
      g.attr("transform", d3.event.transform)
    }

    function tickActions() {
      //update circle positions each tick of the simulation
      node
        .attr("cx", function(d) {
          return d.x;
        })
        .attr("cy", function(d) {
          return d.y;
        });

      //update link positions
      link
        .attr("x1", function(d) {
          return d.source.x;
        })
        .attr("y1", function(d) {
          return d.source.y;
        })
        .attr("x2", function(d) {
          return d.target.x;
        })
        .attr("y2", function(d) {
          return d.target.y;
        });
    }
  </script>
</body>
<h1>Programming Languages that are related to R</h1>
</html>